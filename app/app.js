(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{X:()=>R});const t=[[5,15],[20,35]],n=[[20,30],[15,30]],o={hour:"numeric",minute:"numeric",month:"long",day:"2-digit",year:"numeric"},a={month:"2-digit",day:"2-digit",year:"2-digit"},r=new Headers({"Accept-Encoding":"gzip"}),s=e=>new Map([[new Set([0,1,2,17,36,43,"50d","50n"]).has(e),"fa-exclamation"],[new Set([3,4,37,38,47,"11d","11n"]).has(e),"fa-bolt"],[new Set([5,6,7,10,13,14,15,16,18,41,42,46,"13d","13n"]).has(e),"fa-snowflake"],[new Set([19,20,21,22]).has(e),"fa-smog"],[new Set([23,24]).has(e),"fa-wind"],[new Set([26,"03d","03n","04d","04n"]).has(e),"fa-cloud"],[new Set([28,30,"02d"]).has(e),"fa-cloud-sun"],[new Set([27,29,"02n"]).has(e),"fa-cloud-moon"],[new Set([32,34,"01d"]).has(e),"fa-sun"],[new Set([31,33,"01n"]).has(e),"fa-moon"],[new Set([8,9,11,12,39,45,"09d","09n","10d","10n"]).has(e),"fa-cloud-rain"],[new Set([44,null]).has(e),"fa-slash"]]).get(!0)??"fa-poo-storm",c=navigator.language,i=e=>{const t=e.includes("-")?"-":" ",n=e.split(/[- ]+/).map((e=>e[0].toUpperCase()+e.slice(1).toLowerCase()));return n.join(t)},l=e=>{e.style.opacity=1,e.style.visibility="visible"},d=(e,t)=>{e.checked?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")},m=(e,t)=>Math.floor(Math.random()*(t-e)+1)+e,u=e=>`hsl(${360,Math.floor(360*Math.random())}, ${m(15,25)}%, ${m(e[0],e[1])}%)`,p=e=>e.toLocaleString(c,o),h=()=>{const e=document.querySelector(".modal"),t=document.querySelector(".overlay");[e,t].forEach((e=>e.classList.toggle("hidden")))},g=e=>{document.querySelectorAll(".drag").forEach((e=>{e.dataset.dragstart||(e.dataset.dragstart=!0,e.addEventListener("dragstart",(()=>{e.classList.add("dragging")}))),e.dataset.dragend||(e.dataset.dragend=!0,e.addEventListener("dragend",(()=>{e.classList.remove("dragging")})))})),e.dataset.dragover||(e.dataset.dragover=!0,e.addEventListener("dragover",(t=>{t.preventDefault();const n=((e,t)=>[...e.querySelectorAll(".drag:not(.dragging)")].reduce(((e,n)=>{const o=n.getBoundingClientRect(),a=t-o.top-o.height/2;return a<0&&a>e.offset?{offset:a,element:n}:e}),{offset:Number.NEGATIVE_INFINITY}).element)(e,t.clientY),o=document.querySelector(".dragging");null===n&&e.append(o),e.insertBefore(o,n)})))},y=(e,t)=>{e.forEach(((e,n)=>{t[n].addEventListener("mousedown",(()=>e.draggable=!0)),t[n].addEventListener("mouseup",(()=>e.draggable=!1)),e.addEventListener("dragend",(()=>e.draggable=!1))}))},w=()=>{h(),scrollTo({top:0,left:0,behavior:"smooth"})},f=e=>{"Escape"!==e.key||modalEl.classList.contains("hidden")||h()},v=e=>{e.scrollTop=e.scrollHeight},_=(...e)=>e.map((e=>{const t=document.querySelector(e);return t.checked?t.dataset.on:t.dataset.off}));async function E(){const e=document.querySelector("#bookmarks"),t=document.querySelector("#git"),[n]=_("#colors"),[o,a]=((...e)=>e.map((e=>[...e.querySelectorAll("form")].map((e=>{const t={};return e.querySelectorAll("input").forEach((e=>""==e.value?null:t[e.name]=e.value)),t})))))(e,t),r=o.filter((e=>void 0!==e.name&&void 0!==e.url&&void 0!==e.icon)),s=(c=a.filter((e=>void 0!==e.repo&&void 0!==e.branch)),JSON.parse(JSON.stringify(c).replaceAll(/\s/g,"")));var c;const[i,l]=_("#weather-type","#weather-units").values(),d=document.querySelector("#stations").value.replaceAll(/\s/g,"").split(","),m={colors:n,bookmarks:r,git:{gitRepos:s,gitKey:document.querySelector("#gitkey").value},weather:{type:i,units:l,weatherKey:document.querySelector("#weather-key").value,stations:d},serverMon:{url:document.querySelector("#server-url").value,refresh:document.querySelector("#refresh-time").value}};j("Options",m),R(m),h()}const L=document.querySelector(".options__close"),b=document.querySelector("#bookmarks"),S=document.querySelector("#git"),k=document.querySelector("#weather-type"),$=document.querySelector(".options__inputs--weatherstations");let q=new DocumentFragment,x=new DocumentFragment;const C=(e="",t="",n="")=>{const o=document.createElement("form");o.classList.add("options__forms--row","drag");const a=document.createElement("span");a.classList.add("btn--drag","options__grab");const r=document.createElement("i");r.classList.add("fas","fa-bars");const s=document.createElement("label");s.textContent="Name: ",s.classList.add("options__labels");const c=document.createElement("input");c.type="text",c.name="name",c.placeholder="Google",c.classList.add("options__inputs","options__inputs--bookmarks"),c.value=e;const i=document.createElement("label");i.textContent="Url: ",i.classList.add("options__labels");const l=document.createElement("input");l.type="url",l.name="url",l.placeholder="https://www.google.com",l.classList.add("options__inputs","options__inputs--bookmarks"),l.value=t;const d=document.createElement("label");d.textContent="Icon: ",d.classList.add("options__labels");const m=document.createElement("input");m.type="text",m.name="icon",m.placeholder="fab fa-google",m.classList.add("options__inputs","options__inputs--bookmarks"),m.value=n;const u=document.createElement("span");u.classList.add("btn","options__delete");const p=document.createElement("i");p.classList.add("far","fa-circle-xmark"),a.append(r),s.append(c),i.append(l),d.append(m),u.append(p),o.append(a,s,i,d,u),q.append(o),b.append(q)},A=(e="",t="")=>{const n=document.createElement("form");n.classList.add("options__forms--row","drag");const o=document.createElement("span");o.classList.add("btn--drag","options__grab");const a=document.createElement("i");a.classList.add("fas","fa-bars");const r=document.createElement("label");r.textContent="Repo: ",r.classList.add("options__labels");const s=document.createElement("input");s.name="repo",s.type="text",s.placeholder="jnines/MyTab",s.classList.add("options__inputs","options__inputs--git"),s.value=e;const c=document.createElement("label");c.textContent="Branch: ",c.classList.add("options__labels");const i=document.createElement("input");i.type="text",i.name="branch",i.placeholder="master",i.classList.add("options__inputs","options__inputs--git"),i.value=t;const l=document.createElement("span");l.classList.add("btn","options__delete");const d=document.createElement("i");d.classList.add("far","fa-circle-xmark"),l.append(d),o.append(a),r.append(s),c.append(i),n.append(o,r,c,l),x.append(n),S.append(x)};async function D(e){const t=await e??await F("Options"),n=document.querySelector("#colors"),o=document.querySelector("#weather-type"),a=document.querySelector("#weather-units"),r=document.querySelector("#weather-key"),s=document.querySelector("#stations"),c=document.querySelector("#gitkey"),i=document.querySelector("#server-url"),l=document.querySelector("#refresh-time"),m=document.querySelector(".options__export"),u=document.querySelector("#import-file");document.querySelectorAll(".options__forms--row").forEach((e=>e.remove())),(()=>{const e=document.querySelector(".options-btn"),t=document.querySelector(".options__plus--bookmarks");t.dataset.add||(t.dataset.add=!0,t.addEventListener("click",(e=>{e.preventDefault(),C(),v(b);const t=document.querySelectorAll(".drag"),n=document.querySelectorAll(".btn--drag");g(b),y(t,n)})));const n=document.querySelector(".options__plus--git");n.dataset.add||(n.dataset.add=!0,n.addEventListener("click",(e=>{e.preventDefault(),A(),v(S);const t=document.querySelectorAll(".drag"),n=document.querySelectorAll(".btn--drag");g(S),y(t,n)}))),document.body.addEventListener("load",(()=>d(k,$))),k.addEventListener("change",(()=>d(k,$)));const o=document.querySelector(".options__save");o.removeEventListener("click",E),o.addEventListener("click",E),L.removeEventListener("click",h),L.addEventListener("click",h),e.removeEventListener("click",w),e.addEventListener("click",w)})(),u.addEventListener("change",O),t?.bookmarks.forEach((e=>C(e.name,e.url,e.icon))),C(),t?.git.gitRepos.forEach((e=>A(e.repo,e.branch))),A(),n.checked="bright"===t?.colors??!1,o.checked="wu"===t?.weather.type??!1,a.checked="metric"===t?.weather.units??!1,r.value=t?.weather.weatherKey??"",s.value=t?.weather.stations.join(", ")??"",c.value=t?.git.gitKey??"",i.value=t?.serverMon.url??"",l.value=t?.serverMon.refresh??"",g(b),g(S),d(k,$),document.querySelectorAll(".options__delete")?.forEach((e=>{((e,t)=>{e.addEventListener("click",(e=>{e.target.closest(".options__forms--row").remove()}))})(e),e.addEventListener("click",(e=>{e.target.closest(".options__forms--row").remove()}))}));const p=document.querySelectorAll(".drag"),f=document.querySelectorAll(".btn--drag");y(p,f),I(t,m)}const M=()=>"moz-extension:"===window.location.protocol?"browser":"chrome-extension:"===window.location.protocol?"chrome":"local",I=(e,t)=>{const n=(new Date).toLocaleDateString(c,a).replaceAll("/",""),o=new Blob([JSON.stringify(e,null,2)],{type:"application/json"});t.download=`mytab_${n}.json`,t.href=URL.createObjectURL(o)},O=function(){const e=new FileReader;e.readAsText(this.files[0]),e.onload=()=>D(JSON.parse(e.result)),e.onerror=()=>console.error(e.error)},j=async(e,t)=>{const n=M();if("browser"===n)try{await browser.storage.sync.set({[e]:t})}catch(e){console.error(e)}if("chrome"===n)try{await chrome.storage.sync.set({[e]:t})}catch(e){console.error(e)}if("local"===n)try{window.localStorage.setItem("Options",JSON.stringify(t))}catch(e){console.error(e)}},F=async e=>{const t=M();if("browser"===t)try{return await browser.storage.sync.get(e).then((e=>e.Options))}catch(e){console.error(e)}if("chrome"===t)try{return await(e=>{try{return new Promise((t=>{chrome.storage.sync.get(e,t)}))}catch(e){console.error(e)}})(e).then((e=>e.Options))}catch(e){console.log(e)}if("local"===t)try{return JSON.parse(window.localStorage?.getItem(e))}catch(e){console.error(e)}};async function N({units:e,weatherKey:t,type:n}){const o=sessionStorage.getItem("LAT"),a=sessionStorage.getItem("LNG");if(o&&a){const s=fetch("owm"===n?`https://api.openweathermap.org/data/2.5/onecall?lat=${o}&lon=${a}&exclude=minutely,hourly&units=${e}&appid=${t}`:`https://api.weather.com/v3/wx/forecast/daily/5day?geocode=${o},${a}&format=json&units=${"imperial"===e?"e":"m"}&language=${c}&apiKey=${t}`,r).catch((e=>console.error(e)));return(await s).json()}}async function T(e,o){const a=document.querySelector(".server");let r=new DocumentFragment;try{const s=await async function(e){const t=await fetch(e);if(t.ok)return await t.json()}(e);s.forEach((e=>{const a=document.createElement("div");a.classList.add("server__status","online"===e?.status?"server__status--on":"server__status--off"),a.textContent=`${i(e?.status)}`;const s=document.createElement("div");s.setAttribute("class","server__title"),s.textContent=i(e?.name);const c=document.createElement("i");c.setAttribute("class",`${e?.fa_icon}`),c.style.color=u("dark"===o.colors?[...t[1]]:[...n[1]]),c.alt=e?.name;const l=document.createElement("a");l.classList.add("server__link"),l.href=`${e?.address}:${e?.port}${e?.url}`,l.target="_blank",l.ariaLabel=e?.name;const d=document.createElement("div");d.classList.add("server__container"),d.append(l,c,s,a),r.append(d)})),a.textContent="",a.append(r),l(a)}catch(e){console.error(e)}}function R(e){const o=document.querySelector(".container"),a=document.querySelector(".options-btn"),c=document.querySelector(".overlay"),d=document.querySelector(".bookmarks"),m=document.querySelector(".git"),g=document.querySelector(".weather"),y=document.querySelector(".server"),v=e?.bookmarks.length,_=e?.git.gitRepos.length,E=e?.serverMon.url,L=e?.weather.weatherKey;((...e)=>{e.forEach((e=>{for(;e?.firstChild;)e.removeChild(e.firstChild)}))})(document.querySelector(".bookmarks"),document.querySelector(".git"),document.querySelector(".weather"),document.querySelector(".server"));const b=[v,_,E,L].filter(Boolean).length;if(((...e)=>{document.body.style.backgroundImage=`linear-gradient(${Math.ceil(320*Math.random())+20}deg, ${u(...e)}, ${u(...e)}, ${u(...e)}), none`})("bright"===e?.colors?n[0]:t[0]),!e)return h(),void D();b<=1&&(o.classList.remove("container--multi"),o.classList.add("container--single")),b>1&&(o.classList.remove("container--single"),o.classList.add("container--multi")),L||(g.classList.remove("flex"),g.classList.add("no-display"),v&&(d.style.gridRow="span 2")),_||(m.classList.remove("grid"),m.classList.add("no-display"),v&&(d.style.gridColumn="span 2")),E||(y.classList.remove("flex"),y.classList.add("no-display")),v&&(d.classList.add("grid"),d.classList.remove("no-display"),function(e){let o=new DocumentFragment;const a=document.querySelector(".bookmarks");try{e.forEach(((e,a)=>{const r=document.createElement("a");r.classList.add("bookmarks__link"),r.href=e?.url,r.title=e?.name;const s=document.createElement("div");s.classList.add("bookmarks__container"),s.style.backgroundColor=u("dark"===a?t[1]:n[1]);const c=document.createElement("i");c.setAttribute("class",`${e?.icon.includes("<i")?(e=>{if(e.startsWith("<i"))return e.split('"')[1]})(e.icon):e.icon}`),c.alt=e?.name;const i=document.createElement("div");i.classList.add("bookmarks__title"),i.textContent=e?.name,s.append(r,c,i),o.append(s)})),a.append(o)}catch(e){console.error(e)}}(e.bookmarks,e.colors)),_&&(m.classList.add("grid"),m.classList.remove("no-display"),v&&d.removeAttribute("style"),async function(e){const t=document.querySelector(".git");let n=new DocumentFragment;try{const o=p(new Date);(await async function(e){const t=e.gitKey,n=e.gitRepos.map((e=>{return fetch(`https://api.github.com/repos/${e.repo}/commits?sha=${e.branch}&page=1&per_page=4`,(n=t,{method:"GET",redirect:"follow",headers:{Accept:"application/vnd.github.v3+json",Authorization:`token ${n}`,"User-Agent":"MyTab"}})).then((t=>{if(!t.ok)throw new Error(`${e[0]} ${e[1]} incorrect values`);return t.json()}));var n})),o=await Promise.allSettled(n),a=o.filter((e=>"fulfilled"===e.status)).map((e=>e.value)),r=o.filter((e=>"rejected"===e.status)).map((e=>e.reason));return r.length>=1&&console.error(...r),a}(e)).map((e=>{const t=e[0]?.url.split("/")[5].toUpperCase(),a=e[0]?.html_url.split("/").slice(0,5).join("/"),r=o.split(",")[0],s=p(new Date(e[0]?.commit.committer.date)),c=s.split(",")[0],i=e[0]?.commit.message.split("\n")[0],l=r===c?"git__title--new":"git__title",d=document.createElement("div");d.classList.add("git__container");const m=document.createElement("span");m.classList.add("tooltip","tooltip--git"),m.textContent=`\n                       ${e[1]?p(new Date(e[1]?.commit.committer.date)):""}\n                        ${e[1]?.commit.message.split("\n")[0]??""}\n\n                        ${e[2]?p(new Date(e[2]?.commit.committer.date)):""}\n                        ${e[2]?.commit.message.split("\n")[0]??""}\n\n                        ${e[3]?p(new Date(e[3]?.commit.committer.date)):""}\n                        ${e[3]?.commit.message.split("\n")[0]??""}\n\n    `.replace(/  +/g,"");const u=document.createElement("ul"),h=document.createElement("li");h.setAttribute("class",`${l}`);const g=document.createElement("a");g.href=a,g.textContent=`${t}`;const y=document.createElement("li");y.textContent=`${s}`;const w=document.createElement("li");w.classList.add(".git__message"),w.textContent=`${i}`,h.append(m,g),u.append(h,y,w),d.append(u),n.append(d)}))}catch(e){console.error(e)}finally{t.append(n),l(t)}}(e.git)),E&&(y.classList.add("flex"),y.classList.remove("no-display"),T(E,e.colors),setInterval(T,1e3*e.serverMon.refresh,E,e.colors));navigator.geolocation&&L&&(y.classList.add("flex"),y.classList.remove("no-display"),navigator.geolocation.getCurrentPosition((async t=>{const{latitude:n,longitude:o}=await t.coords;g.classList.add("flex"),g.classList.remove("no-display"),sessionStorage.setItem("LAT",n),sessionStorage.setItem("LNG",o),"owm"===e.weather.type&&await async function(e){const t=document.querySelector(".weather");let n=new DocumentFragment,o=new DocumentFragment;try{const{current:a,daily:r}=await N(e);if(a&&r){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],t=document.createElement("weather-cur");t.classList.add("weather-cur","flex");const c=document.createElement("i");c.setAttribute("class",`fas ${s(a.weather[0].icon)}`);const l=document.createElement("span");l.classList.add("tooltip","tooltip--weather"),l.textContent=`${i(a.weather[0].description)}, Feels like ${Math.round(a.feels_like)}`;const d=document.createElement("div");d.classList.add("weather-cur__temp"),d.textContent=`${Math.round(a.temp)}°`,t.append(l,c,d),n.append(t),r.forEach((t=>{const n=new Date(1e3*t.dt),a=e[n.getDay()],r=document.createElement("div"),c=document.createElement("div");c.classList.add("weather-fc__days");const l=document.createElement("i");l.setAttribute("class",`fas ${s(t.weather[0].icon)}`);const d=document.createElement("div");d.classList.add("weather-fc__column");const m=document.createElement("span");m.classList.add("tooltip","tooltip--weather"),m.textContent=`${i(t.weather[0].description)}`;const u=document.createElement("div");u.classList.add("weather-fc__highs"),u.textContent=`${Math.round(t.temp.max)}°`;const p=document.createElement("div");p.classList.add("weather-fc__lows","padding-sm--top","padding-sm--bot"),p.textContent=`${Math.round(t.temp.min)}°`,c.append(a),d.append(m,c,l,u,p),r.append(d),o.append(r)}))}t.append(n,o),l(t)}catch(e){console.error(e)}}(e.weather),"wu"===e.weather.type&&await async function(e){const t=document.querySelector(".weather");let n=new DocumentFragment,o=new DocumentFragment;try{const a=await async function({stations:e,units:t,weatherKey:n}){const o=e.map((e=>fetch(`https://api.weather.com/v2/pws/observations/current?stationId=${e}&format=json&units=${"imperial"==t?"e":"m"}&apiKey=${n}`,r).catch((e=>console.error(`One or more of the servers is unreachable: ${e}`))))),a=await Promise.any(o);return(await a).json()}(e),c=await N(e);if(a&&c){const e=a.observations[0].stationID,r=c.daypart[0].iconCode.filter(((e,t)=>t%2==0)),i=c.daypart[0].iconCode.filter(((e,t)=>t%2==1)),d=c.temperatureMax,m=c.temperatureMin,u=c.daypart[0].narrative.filter(((e,t)=>t%2==0)),p=c.daypart[0].narrative.filter(((e,t)=>t%2==1)),h=document.createElement("a");h.classList.add("weather__link"),h.href=`https://www.wunderground.com/forecast/${e}`,h.ariaLabel="Weather Underground Forecast";const g=document.createElement("div");g.classList.add("weather-cur","flex");const y=document.createElement("i");y.setAttribute("class",`fas ${r[0]?s(r[0]):s(i[0])}`),y.alt="Current weather conditions";const w=document.createElement("span");w.classList.add("tooltip","tooltip--weather","tooltip--short"),w.textContent=`Feels like ${a.observations[0].imperial?.heatIndex||a.observations[0].metric?.heatIndex||a.observations[0].uk_hybrid?.heatIndex||a.observations[0].imperial?.windChill||a.observations[0].metric?.windChill||a.observations[0].uk_hybrid?.windChill}°`;const f=document.createElement("div");f.classList.add("weather-cur__temp"),f.textContent=`${a.observations[0].imperial?.temp||a.observations[0].metric?.temp||a.observations[0].uk_hybrid.temp}°`,g.append(w,y,f),n.append(g);const v=document.createElement("div");v.classList.add("weather-fc","flex"),c.dayOfWeek.forEach(((e,t)=>{const n=document.createElement("div"),a=document.createElement("div");a.classList.add("weather-fc__days"),a.textContent=`${e.slice(0,3).toUpperCase()}`;const c=document.createElement("div");c.classList.add("weather-fc__column");const l=document.createElement("div");l.classList.add("tooltip","tooltip--weather"),l.textContent=u[t]?`${e}: \n            ${u[t]}\n            \n            ${e} evening:\n            ${p[t]}`:`${e} evening:\n            ${p[t]}`;const h=document.createElement("i");h.setAttribute("class",`fas ${s(r[t])}`),h.alt="Day time weather images";const g=document.createElement("div");g.classList.add("weather-fc__highs"),g.textContent=d[t]?d[t]+"°":"--",g.alt="High temperature for the day";const y=document.createElement("i");y.setAttribute("class",`fas ${s(i[t])}`),y.alt="Night time weather images";const w=document.createElement("div");w.classList.add("weather-fc__lows"),w.textContent=`${m[t]}°`,w.alt="Low temperature for the day",c.append(h,g,y,w),a.append(l),n.append(a,c),v.append(n),o.append(v)})),t.append(h,n,o),l(t)}}catch(e){console.error(e)}}(e.weather)}),(()=>{const e=document.querySelector(".weather"),t=document.createElement("details"),n=document.createElement("summary");t.textContent="Require location data to render weather",n.textContent="Weather",t.append(n),e.append(t),l(e)}))),a.removeEventListener("click",w),a.addEventListener("click",w),c.removeEventListener("click",h),c.addEventListener("click",h),document.removeEventListener("keydown",f),document.addEventListener("keydown",f),D()}!async function(){R(await F("Options"))}()})();